## 数据库表设计实战

数据库如何优化，如何建立索引、垂直拆分，表结构设计等。。。 实战篇不会过多解释，理论是前提，更重要的是事实大于雄辩。我会把整个过程和思路带着新手走一遍，本人面试过那些说的头头是道，可惜没有在项目实际中使用过，希望大家有实际的设计经验，不要纸上谈兵，出去面试也有底气。

---
>  以下拿出两个作者亲身经历涉足的项目案例，结合优化技巧，实践得到合理的数据库的设计的一个解决方案。 本人经验有限，凡不合理的地方，望请指出或探讨。

#### 为什么选择电商？

首先，本人接触过电商行业，为什么选择电商行业这个话题？我觉得他确实是一个练手的好项目，为什么呢？有的人可能疑问，一个完整的商城，他的业务复杂，每一个细分的领域都适合单独起一个项目，但商城发展了很多年，业务成熟，都能较好的拆分出微服务，而且参考案例也比较多，如有赞，淘宝，京东，国内php、java开源商城也比较多。所以，商城的开发难度适中，技术复杂度也适中。


#### 商品数据库设计

>  首先，明确本人只想根据优化技巧，来设计出一个符合期望的表的结构，并不会涉及过多商城的复杂的业务。其中与用户商品相关的不会提到，比如收藏，浏览记录。因为这里的思想跟后面提到的评论，点赞很相似。只关注商品的基本信息 规格、价格。

##### 商品表信息

- 商品规格表
一对多关系的表：  一个商品有多个规格。如衣服：颜色、尺寸。

- 商品价格表
一对多关系：一个规格有多个价格。也就是SKU代表一个产品。

- 商品详情表
一对一关系： 垂直拆分的，商品详情页是大文本的。

- 商品图片表
一对多关系： 商品有多个图片。

- 商品数据表
一对一关系： 垂直拆分，可以理解为动态表，也就是更新频繁的表。如库存数、销量、收藏数、浏览数，是否热门。。。

商品一对一关系的可以看出对商品进行了垂直拆分，拆分理由在最后说明。

##### 表设计和字段选择 
- 字段尽量设置默认值，且不能为空。
是否上架 默认上架 是否热门（1热门：0不热门） 默认0

- 必填字段，如商品标题 字段设置不能为空 
- 是否热门、上下架 字段设置tinyint 长度为1.
- 日期不要用字符串类型，本人使用了datetime类型,不是最好，但觉得通用些。
- 尽量使用整形。

-不要设置外键和唯一键，使用代码进行约束。

##### 商品冗余信息  

冗余就是不必要的字段。

- 商品规格冗余了哪些信息
规格表里有规格id 和 规格值 比如 1就是规格 白色就是规格值。 当然有的可能还有店铺或者分类。这也是根据您的公司或者产品需求定的，不在讨论范围内。
规格表里的规格值。 id ： 白色。
冗余规格值是因为选择规格的时候需要根据商品获取所有的规格。

- 商品价格冗余信息
商品价格表里冗余了不同规格值信息，并且是逗号分割的。比如衣服 （白色，XXL）本来就有的规格的id(3，20)；
这里冗余是因为

- 商品信息表冗余
可以根据需求冗余商品分类名称，店铺名称，商品图片表的主图。

- 为何垂直拆分
商品详情表，可以是图片，也可以是文字，甚至是html，大文本。又由于商品信息表本身字段就多，务必拆分出去。
为何拆分商品数据表？无论是销量，库存，浏览数 都会频繁的更新，不想让他影响商品信息表。是否热门这个字段，看产品经理，选择适当的逻辑，我这里拆分出去是因为，可能会一个小时变化一次热门的商品。它也可以放到商品信息表里，跟上下架一样，不是很频繁。

- 调优需要懂得把握分寸
比如商品分类没有确定好的，不建议冗余商品分类名称。店铺名称是一般不会变的，需要审核，所以适合冗余。如果是用户的昵称，不建议冗余，虽然更新的频率不大，如果一旦更改，关联的表要同步更新，增加代码量，优化意义也不大，性能影响可以加入缓存。


#### 微博、贴吧数据库设计

微博、贴吧其实就是评论数据库设计。与用户关联的数据。






 